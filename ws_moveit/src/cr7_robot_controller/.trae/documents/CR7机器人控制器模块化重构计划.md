# CR7机器人控制器模块化重构计划

## 1. 问题分析

当前代码结构存在以下问题：
- **main.cpp**：包含大量无用的交互代码（菜单、用户输入等），测试代码与核心逻辑混合
- **cr7_robot_controller**：功能过于庞大，单文件包含500+行代码，难以维护
- **模块化不足**：所有功能集中在一个类中，缺乏清晰的职责分离

## 2. 重构目标

- **模块化**：将功能分化到不同的文件和模块中
- **轻量化**：移除无用的交互代码，保留核心功能
- **易维护**：清晰的代码结构和职责分离
- **易扩展**：模块化设计便于添加新功能
- **兼容性**：保持现有接口不变，确保现有代码可以正常工作

## 3. 重构计划

### 3.1 重构 main.cpp

1. **移除交互代码**：
   - 删除所有菜单显示函数（`showMenu`、`showPilzMenu`）
   - 删除用户输入处理函数（`inputThread`、`processCommand`、`processPilzCommand`）
   - 删除终端设置函数（`setNonBlockingInput`、`resetTerminal`、`getCharNonBlocking`）

2. **简化核心逻辑**：
   - 保留ROS2初始化、控制器创建和执行逻辑
   - 简化信号处理，只保留必要的关闭逻辑
   - 移除线程管理，使用更简洁的执行方式

3. **参数化配置**：
   - 支持从ROS参数加载配置
   - 提供命令行参数来选择执行模式

### 3.2 重构 cr7_robot_controller

1. **核心模块拆分**：
   - `cr7_base_controller.hpp/cpp`：基础控制器类，包含核心功能
   - `cr7_cartesian_planner.hpp/cpp`：笛卡尔路径规划模块
   - `cr7_pilz_planner.hpp/cpp`：PILZ工业规划器模块
   - `cr7_path_planner.hpp/cpp`：预设路径执行模块
   - `cr7_utils.hpp/cpp`：工具类和辅助函数

2. **接口设计**：
   - 保持`CR7RobotController`类作为主接口
   - 内部使用组合模式，将功能委托给各个子模块
   - 确保现有方法签名不变

### 3.3 创建测试模块

1. **测试文件结构**：
   - `test/cr7_test_main.cpp`：测试主入口
   - `test/cr7_test_utils.hpp`：测试工具函数
   - `test/cr7_test_cases.hpp`：测试用例定义

2. **测试功能**：
   - 将原main.cpp中的测试函数移到测试模块
   - 提供命令行参数来选择要运行的测试
   - 支持自动化测试和手动测试两种模式

### 3.4 创建配置模块

1. **配置文件结构**：
   - `include/cr7_robot_controller/config/cr7_config.hpp`：配置数据结构
   - `include/cr7_robot_controller/config/cr7_config_loader.hpp`：配置加载器

2. **配置功能**：
   - 支持从ROS参数加载配置
   - 支持从YAML文件加载配置
   - 提供默认配置值

## 4. 实施步骤

1. **第一步**：重构 main.cpp，移除无用的交互代码，简化核心逻辑
2. **第二步**：创建测试模块，将测试代码移到单独的文件中
3. **第三步**：拆分 cr7_robot_controller，创建各个子模块
4. **第四步**：创建配置模块，支持参数化配置
5. **第五步**：测试重构后的代码，确保功能正常
6. **第六步**：更新文档和示例代码

## 5. 预期效果

- **代码结构清晰**：功能模块分离，职责明确
- **维护性提高**：每个模块代码量减少，便于理解和修改
- **扩展性增强**：新功能可以通过添加新模块实现
- **性能优化**：移除无用代码，减少运行时开销
- **兼容性保持**：现有